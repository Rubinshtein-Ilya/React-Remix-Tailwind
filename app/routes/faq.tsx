import { useTranslation } from "react-i18next";
import { useEffect, useState } from "react";

import faq1IMG from "../assets/images/faq/faq1.png";
import faq2IMG from "../assets/images/faq/faq2.png";
import { LoginModal } from "~/components/Dialogs/LoginModal";
import { NavLink } from "react-router";
import { Controller, useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { Input } from "~/shared/inputs";
import { AppButton } from "~/shared/buttons/AppButton";
import { RiArrowRightLongLine } from "@remixicon/react";
import { cn } from "~/lib/utils";
import { formatPhoneNumber } from "~/utils/formatPhoneNumber";
import { useSendSupportRequest } from "~/queries/user";
import { useUser } from "~/queries/auth";

export function FAQComponent({ embedded = false }: { embedded?: boolean }) {
  const { t } = useTranslation();
  const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
  const [open, setOpen] = useState<{ section: number; item: number } | null>(
    null
  );
  const [submitMessage, setSubmitMessage] = useState<string | null>(null);

  const sendSupportMutation = useSendSupportRequest();
  const { user } = useUser();
  const feedbackSchema = z.object({
    name: z
      .string()
      .min(1, { message: t("pages.partners.validation.name_required") }),
    email: z
      .string()
      .email({ message: t("pages.partners.validation.email_invalid") }),
    phone: z
      .string()
      .min(1, t("errors.phone_required"))
      .transform((value) => formatPhoneNumber(value))
      .refine((value) => {
        if (!/^\+7 \d{3} \d{3}-\d{2}-\d{2}$/.test(value)) {
          return false;
        }
        const numbers = value.replace(/\D/g, "");
        if (!numbers.startsWith("7") || numbers.length !== 11) {
          return false;
        }
        return true;
      }, t("errors.phone_invalid_format")),
    message: z
      .string()
      .min(1, { message: t("pages.partners.validation.message_required") }),
    search: z.string().optional(),
  });

  type FeedbackFormData = z.infer<typeof feedbackSchema>;

  const {
    register,
    handleSubmit,
    formState: { errors, isValid },
    control,
    watch,
    reset,
  } = useForm<FeedbackFormData>({
    resolver: zodResolver(feedbackSchema),
    mode: "onChange",
    defaultValues: {
      name: user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() : "",
      email: user?.email || "",
      phone: user?.phone || "",
      message: "",
      search: "",
    },
  });

  const search = watch("search");

  // Обновляем поля формы при изменении пользователя
  useEffect(() => {
    if (user) {
      reset({
        name: `${user.firstName || ''} ${user.lastName || ''}`.trim(),
        email: user.email || "",
        phone: user.phone || "",
        message: "",
        search: "",
      });
    }
  }, [user, reset]);

  const faqSections = [
    {
      title: "Общие вопросы",
      items: [
        {
          question: "Могу ли я изменить e-mail адрес?",
          answer:
            "Нет, изменить e-mail адрес в уже зарегистрированном аккаунте невозможно. В случае необходимости изменить адрес, мы рекомендуем вам создать новый аккаунт с желаемым e-mail.",
        },
        {
          question: "Как удалить аккаунт?",
          answer:
            'Для удаления аккаунта авторизуйтесь в системе, перейдите в настройки профиля и внизу страницы нажмите кнопку "Удалить профиль". Пожалуйста, обратите внимание, что удаление аккаунта приведет к удалению всех данных, связанных с вашим профилем.',
        },
        {
          question: "Не получается авторизоваться. Что делать?",
          answer: (
            <span>
              Если у вас возникли проблемы с авторизацией, попробуйте
              использовать другой способ входа или нажмите на кнопку{" "}
              <span
                onClick={() => setIsLoginModalOpen(true)}
                className="text-blue-500 cursor-pointer"
              >
                "Забыли пароль?"
              </span>{" "}
              для сброса пароля и восстановления доступа к вашему аккаунту. Если
              ни один из предложенных вариантов вам не помог, напишите на почту{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
            </span>
          ),
        },
        {
          question: "Как делать ставки?",
          answer: (
            <div>
              Для того чтобы сделать ставку, выберите товар, на который хотите
              поставить, и введите сумму ставки. Вы можете воспользоваться
              подсказкой с "быстрыми ставками", которая покажет минимально
              возможную ставку в данный момент. Минимальные шаги ставок зависят
              от текущей цены товара:
              <ul className="mt-2 space-y-1">
                <li>Цена товара до 5 000 руб. — минимальный шаг: 250 руб.</li>
                <li>5 000 - 10 000 руб. — минимальный шаг: 500 руб.</li>
                <li>10 000 - 20 000 руб. — минимальный шаг: 1 000 руб.</li>
                <li>20 000 - 30 000 руб. — минимальный шаг: 2 000 руб.</li>
                <li>30 000 - 50 000 руб. — минимальный шаг: 3 000 руб.</li>
                <li>50 000 - 100 000 руб. — минимальный шаг: 5 000 руб.</li>
                <li>100 000 - 200 000 руб. — минимальный шаг: 10 000 руб.</li>
                <li>200 000 - 300 000 руб. — минимальный шаг: 20 000 руб.</li>
                <li>300 000 - 400 000 руб. — минимальный шаг: 30 000 руб.</li>
                <li>400 000 - 500 000 руб. — минимальный шаг: 40 000 руб.</li>
                <li>500 000 - 600 000 руб. — минимальный шаг: 50 000 руб.</li>
                <li>600 000 - 700 000 руб. — минимальный шаг: 60 000 руб.</li>
                <li>700 000 - 800 000 руб. — минимальный шаг: 70 000 руб.</li>
                <li>800 000 - 900 000 руб. — минимальный шаг: 80 000 руб.</li>
                <li>900 000 - 1 000 000 руб. — минимальный шаг: 90 000 руб.</li>
                <li>
                  <b>
                    {" "}
                    От 1 000 000 руб. и далее — минимальный шаг: 100 000 руб.
                  </b>
                </li>
              </ul>
            </div>
          ),
        },
        {
          question: "Как создать аккаунт",
          answer: (
            <span>
              Чтобы создать аккаунт, перейдите в раздел{" "}
              <span
                onClick={() => setIsLoginModalOpen(true)}
                className="cursor-pointer text-blue-500"
              >
                "Регистрация"
              </span>
              , подтвердите свой e-mail или авторизуйтесь через VK ID, SBER ID
              или Яндекс ID.
            </span>
          ),
        },
        {
          question: "Регистрация и участие в аукционе бесплатные?",
          answer:
            "Да, регистрация на платформе и участие в аукционах абсолютно бесплатны. Однако, мы просим вас ответственно относиться к участию, так как ставка имеет юридическую силу, и, сделав ставку, вы соглашаетесь с условиями аукциона, обязывающими вас купить товар, если ваша ставка окажется самой высокой.",
        },
        {
          question:
            "Как я могу задать вопрос, оставить отзыв или предложить идеи?",
          answer: (
            <span>
              Для того чтобы задать вопрос, оставить отзыв или предложить
              улучшения, отправьте письмо на нашу почту:{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              . Мы обязательно рассмотрим ваши предложения и постараемся
              ответить на все вопросы.
            </span>
          ),
        },
        {
          question: "Почему я должен регистрироваться, чтобы делать ставку?",
          answer:
            "Регистрация необходима для обеспечения безопасности, прозрачности и исполнения законодательства нашей платформой. Мы хотим, чтобы каждый пользователь мог наслаждаться безопасным процессом ставок, и для этого требуется подтвержденная учетная запись.",
        },
        {
          question: "Кто может создать аккаунт на Fan's Dream?",
          answer:
            "Аккаунт на нашей платформе может создать любой пользователь, достигший возраста 18 лет и старше. Участие в аукционах и совершение ставок доступно только зарегистрированным пользователям.",
        },
      ],
    },
    {
      title: "АУКЦИОН",
      items: [
        {
          question: "Товар пропал из продажи",
          answer:
            "Такого не должно было случиться, но если товар пропал из продажи, это может означать, что с ним возникла непредвиденная ситуация, и мы больше не можем его продавать. В таком случае аукцион будет отменен, и все участники получат уведомление об этом.",
        },
        {
          question: "Какой размер у товара?",
          answer:
            "Мы анализируем информацию о товаре при получении и указываем в карточке товара тот размер, который указан на товаре. ",
        },
        {
          question: "Почему аукцион продлевается на 5 минут?",
          answer: (
            <div>
              Аукцион продлевается на 5 минут, если последняя ставка была
              сделана менее чем за 5 минут до окончания аукциона.
              <br />
              <br />
              Например:
              <ul className="mt-2 space-y-1">
                <li>Аукцион заканчивается в 18:00</li>
                <li>Последняя ставка сделана в 17:58</li>
                <li>Аукцион автоматически продлевается до 18:03.</li>
              </ul>
              <br />
              Аукцион завершится, если в течение продленного времени никто не
              сделает ставку. Если в эти 5 минут будет сделана новая ставка,
              аукцион продлится еще на 5 минут. Количество продлений не
              ограничено.
              <br />
              <br />
              <strong>Примечание:</strong> Мы оставляем за собой право изменять
              продолжительность аукциона в случае непредвиденных обстоятельств.
            </div>
          ),
        },
        {
          question: 'Что означают надписи "worn", "с автографом" и т.д.?',
          answer:
            'Эти надписи описывают характеристики товара. "Worn" означает, что товар был использован спортсменом в официальных соревнованиях или тренировках. "С автографом" означает, что на товаре есть настоящий автограф спортсмена. ',
        },
        {
          question: "Какая может быть максимальная ставка?",
          answer:
            "Максимальная ставка не может превышать пятикратной суммы текущей ставки. ",
        },
        {
          question: "Могу ли я делать ставки одновременно на несколько лотов?",
          answer:
            "Да, вы можете делать ставки на несколько лотов одновременно. Однако, если вы не совершали покупок ранее и ваша ставка превысит 50 000 руб., мы приостановим возможность делать ставки на другие лоты до тех пор, пока ваша ставка не будет перебита или вы не выкупите выигранный лот. ",
        },
        {
          question: "Когда начинается и заканчивается аукцион?",
          answer: (
            <div>
              Аукцион начинается, когда товары проверены и подготовлены к
              продаже. Чтобы не пропустить товары от любимых спортсменов и
              клубов, подписывайтесь на наши социальные сети:
              <ul className="space-y-2 mt-2 text-sm">
                <li>
                  <a
                    href="https://vk.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.vk")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://t.me/fansdreamru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.telegram")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.instagram.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.instagram")}
                    {"*"}
                  </a>
                </li>
              </ul>
              <br />
              Также вы можете перейти в раздел "Любимые команды и спортсмены" в
              личном кабинете и подписаться на интересующие вас виды спорта,
              клубы и спортсменов.
              <br />
              <br />
              Обратный счетчик под каждым товаров показывает время до окончания
              аукциона. Также можно проверить точное время окончания аукциона в
              карточке товара.
              <br />
              <br />
              <strong>Обратите внимание:</strong> Если последняя ставка сделана
              менее чем за 5 минут до конца аукциона, он автоматически
              продлевается на 5 минут.
            </div>
          ),
        },
        {
          question: "Могу ли я отменить ставку?",
          answer:
            "Нет, ставка имеет юридическую силу. Сделав ставку, вы соглашаетесь с правилами аукциона и офертой, которая обязывает вас купить товар, если ваша ставка окажется самой высокой. Будьте внимательны при размещении ставок, так как отменить их невозможно.",
        },
        {
          question: "Могу ли я определить сумму своей ставки?",
          answer: (
            <div>
              Да, вы можете выбрать сумму ставки, но она должна быть больше
              минимально допустимой. Если сумма ставки превышает 50 000 руб., мы
              приостановим возможность делать ставки на другие лоты до тех пор,
              пока ваша ставка не будет перебита или вы не выкупите выигранный
              лот.
              <br />
              <br />
              <strong>Шкала минимальных шагов ставок:</strong>
              <ul className="mt-2 space-y-1">
                <li>до 5 000 руб. — минимальный шаг: 250 руб.</li>
                <li>5 000 - 10 000 руб. — минимальный шаг: 500 руб.</li>
                <li>10 000 - 20 000 руб. — минимальный шаг: 1 000 руб.</li>
                <li>20 000 - 30 000 руб. — минимальный шаг: 2 000 руб.</li>
                <li>30 000 - 50 000 руб. — минимальный шаг: 3 000 руб.</li>
                <li>50 000 - 100 000 руб. — минимальный шаг: 5 000 руб.</li>
                <li>100 000 - 200 000 руб. — минимальный шаг: 10 000 руб.</li>
                <li>200 000 - 300 000 руб. — минимальный шаг: 20 000 руб.</li>
                <li>300 000 - 400 000 руб. — минимальный шаг: 30 000 руб.</li>
                <li>400 000 - 500 000 руб. — минимальный шаг: 40 000 руб.</li>
                <li>500 000 - 600 000 руб. — минимальный шаг: 50 000 руб.</li>
                <li>600 000 - 700 000 руб. — минимальный шаг: 60 000 руб.</li>
                <li>700 000 - 800 000 руб. — минимальный шаг: 70 000 руб.</li>
                <li>800 000 - 900 000 руб. — минимальный шаг: 80 000 руб.</li>
                <li>900 000 - 1 000 000 руб. — минимальный шаг: 90 000 руб.</li>
                <li>
                  От 1 000 000 руб. и далее — минимальный шаг: 100 000 руб.
                </li>
              </ul>
            </div>
          ),
        },
        {
          question: "Моя ставка победила, что дальше?",
          answer: (
            <div>
              Поздравляем! В ближайшее время вы получите подтверждение на почту.
              После победы в аукционе вам нужно оплатить товар в течение 24
              часов. Для этого у вас есть несколько способов:
              <ul className="mt-2 space-y-1 list-disc list-inside">
                <li>
                  Перейдите по ссылке для оплаты из письма на электронной почте.
                </li>
                <li>Зайдите в корзину и оплатите товар.</li>
                <li>
                  Зайдите в личном кабинете в раздел «Мои ставки», выберите
                  «Выигранные» и нажмите кнопку «Оплатить».
                </li>
              </ul>
              <br />
              Если оплата не поступит в течение 24 часов, средства будут списаны
              с привязанной к вашему аккаунту карты. После получения оплаты
              товар будет подготовлен к отправке, и вы получите трек-номер для
              отслеживания.
            </div>
          ),
        },
        {
          question: "Почему моя ставка была отклонена?",
          answer: (
            <div>
              Ваша ставка могла быть отклонена по следующим причинам:
              <ul className="mt-2 space-y-1 list-disc list-inside">
                <li>
                  Ставка была ниже минимально допустимой (см. шкалу минимальных
                  ставок).
                </li>
                <li>
                  Сумма ставки содержит недопустимые символы (буквы, знаки
                  препинания).
                </li>
                <li>
                  Ваши возможности делать ставки были ограничены, если:
                  <ul className="ml-4 mt-1 space-y-1 [&>li]:relative [&>li]:pl-6 [&>li]:before:content-[''] [&>li]:before:absolute [&>li]:before:left-0 [&>li]:before:top-2 [&>li]:before:w-2 [&>li]:before:h-2 [&>li]:before:border-2 [&>li]:before:border-[var(--text-primary)] [&>li]:before:rounded-full [&>li]:before:bg-transparent">
                    <li>
                      Вы не оплатили выигранный товар. После оплаты ограничение
                      снимается.
                    </li>
                    <li>
                      Сумма вашей ставки превысила 50 000 руб. Возможность
                      делать ставки восстанавливается после того, как ваша
                      ставка будет перебита или вы выкупите выигранный лот.
                    </li>
                  </ul>
                </li>
              </ul>
              <br />
              <strong>Шкала минимальных шагов ставок:</strong>
              <ul className="mt-2 space-y-1">
                <li>до 5 000 руб. — минимальный шаг: 250 руб.</li>
                <li>5 000 - 10 000 руб. — минимальный шаг: 500 руб.</li>
                <li>10 000 - 20 000 руб. — минимальный шаг: 1 000 руб.</li>
                <li>20 000 - 30 000 руб. — минимальный шаг: 2 000 руб.</li>
                <li>30 000 - 50 000 руб. — минимальный шаг: 3 000 руб.</li>
                <li>50 000 - 100 000 руб. — минимальный шаг: 5 000 руб.</li>
                <li>100 000 - 200 000 руб. — минимальный шаг: 10 000 руб.</li>
                <li>200 000 - 300 000 руб. — минимальный шаг: 20 000 руб.</li>
                <li>300 000 - 400 000 руб. — минимальный шаг: 30 000 руб.</li>
                <li>400 000 - 500 000 руб. — минимальный шаг: 40 000 руб.</li>
                <li>500 000 - 600 000 руб. — минимальный шаг: 50 000 руб.</li>
                <li>600 000 - 700 000 руб. — минимальный шаг: 60 000 руб.</li>
                <li>700 000 - 800 000 руб. — минимальный шаг: 70 000 руб.</li>
                <li>800 000 - 900 000 руб. — минимальный шаг: 80 000 руб.</li>
                <li>900 000 - 1 000 000 руб. — минимальный шаг: 90 000 руб.</li>
                <li>
                  От 1 000 000 руб. и далее — минимальный шаг: 100 000 руб.
                </li>
              </ul>
            </div>
          ),
        },
        {
          question: "Что происходит с доходами от продажи товаров?",
          answer:
            "Наши партнеры самостоятельно решают, как распорядиться доходами от продаж. Некоторые передают выручку на благотворительность, другие используют её как дополнительный доход. Мы информируем наших покупателей о целях продажи, если эта информация доступна. Часть выручки мы будем передавать на благотворительность.",
        },
        {
          question:
            "Как я могу убедиться, что моя ставка самая высокая на данный момент?",
          answer:
            'Вы можете отслеживать текущие ставки в разделе "Мои ставки" в личном кабинете. Также мы уведомим вас по электронной почте, если вашу ставку перебьют.',
        },
        {
          question:
            "Я выиграл товар, но мне он больше не нужен или я не могу заплатить. Могу ли я отменить ставку?",
          answer:
            "К сожалению, все ставки являются обязательными и безотзывными. Если вы сделали ставку, и она оказалась победной, вы обязаны купить товар. Если вы не оплатите его в течение 72 часов, ваш аккаунт будет заблокирован, и мы обратимся в суд для взыскания денежных средств.",
        },
      ],
    },
    {
      title: "ДОСТАВКА",
      items: [
        {
          question: "Кто доставляет товар?",
          answer:
            "Мы доставляем товар исключительно с помощью СДЭК, чтобы гарантировать высокое качество обслуживания и быструю доставку.",
        },
        {
          question:
            "Могу ли я забрать товар на вашем складе или пункте выдачи заказа?",
          answer:
            "Нет, мы доставляем товар только до вашего дома, чтобы гарантировать его сохранность и удобство получения.",
        },
        {
          question: "Какие есть способы доставки?",
          answer:
            "Мы предлагаем два варианта доставки: стандартная доставка и экспресс-доставка. Вы можете выбрать удобный способ при оформлении заказа.",
        },
        {
          question: "Когда я получу трек-номер для отслеживания?",
          answer: (
            <div>
              Как только курьер отсканирует ваш заказ, вы получите уведомление
              по электронной почте или СМС с информацией о вашей посылке. Обычно
              это происходит в течение 2 рабочих дней после оплаты заказа. Также
              вы можете уточнить трек-номер в личном кабинете в разделе «Мои
              заказы».
              <br />
              <br />
              <img src={faq1IMG} alt="faq1" />
            </div>
          ),
        },
        {
          question: "Моя доставка задерживается. Что делать?",
          answer:
            "Если ваша доставка задерживается, пожалуйста, обратитесь в СДЭК с номером вашего отправления. Они помогут решить возникшую проблему и предоставят актуальную информацию.",
        },
        {
          question: "Когда будет отправлен мой товар?",
          answer: (
            <span>
              Обычно товар отправляется в течение 2 рабочих дней. После отправки
              вы получите электронное письмо с номером для отслеживания посылки.
              Если товар не был получен в течение 10 дней, пожалуйста, свяжитесь
              с нашей службой поддержки по почте{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              . Если вы заказали дополнительную услугу по оформлению товара, нам
              потребуется до 10 рабочих дней для выполнения оформления и
              отправки товара. Для некоторых товаров доставка может занять
              больше времени.
            </span>
          ),
        },
        {
          question: "Могу ли я отказаться от товара или вернуть его?",
          answer:
            "Нет, мы продаем уникальные товары, поэтому возврат товара невозможен.",
        },
        {
          question:
            "Меня не будет дома, когда запланирована доставка. Что делать?",
          answer: (
            <span>
              После того как курьер заберет вашу посылку, вы получите номер
              отслеживания по электронной почте. Это позволит вам отслеживать
              посылку и изменить предпочтения по доставке. Мы настоятельно
              рекомендуем связаться со СДЭК в чате на сайте{" "}
              <a
                href="https://www.cdek.ru/"
                target="_blank"
                className="text-blue-500 hover:underline"
              >
                https://www.cdek.ru/{" "}
              </a>
              или по телефону:{" "}
              <a
                href="tel:+74950090405"
                className="text-blue-500 hover:underline"
              >
                +7 495 009 04 05
              </a>{" "}
              (время работы с 06:00 (МСК) до 21:00 (МСК)), чтобы они могли
              скорректировать дату и время доставки для вас.
            </span>
          ),
        },
        {
          question: "Могу ли я изменить свой адрес доставки?",
          answer:
            "Вы можете изменить адрес доставки только до завершения оплаты заказа. После того как оплата будет произведена, изменить адрес будет невозможно. Убедитесь, что ваш адрес доставки указан корректно перед оплатой заказа. Изменения адреса будут учтены только для будущих заказов.",
        },
        {
          question: "Сколько стоит доставка?",
          answer: (
            <div>
              Стоимость доставки рассчитывается автоматически на основе веса,
              габаритов товара и адреса доставки. Предполагаемая стоимость
              доставки будет отображаться до размещения ставки, чтобы вы могли
              видеть общую стоимость. Стоимость доставки может измениться по
              независящим от нас причинам, включая изменения упаковки или
              дополнительных услуг.
              <br />
              <br />
              <img src={faq2IMG} alt="faq2" />
            </div>
          ),
        },
        {
          question: "Мне нужно получить товар как можно скорее. Что делать?",
          answer: (
            <span>
              Мы стараемся отправлять товары как можно быстрее — обычно в
              течение 1-2 рабочих дней, и доставка занимает еще от 1 дня. Если
              вам нужно получить товар срочно, мы рекомендуем выбрать
              экспресс-доставку. Если товар нужен для особого случая и вы
              переживаете, что он не будет доставлен вовремя, напишите нам на
              почту{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              , и мы сделаем все возможное, чтобы доставить его как можно
              скорее.
            </span>
          ),
        },
        {
          question: "Могу ли я выбрать службу доставки?",
          answer:
            "Нет, в настоящее время мы работаем только с СДЭК. Мы тщательно выбирали партнера, который обеспечит быструю и безопасную доставку с широким покрытием.",
        },
        {
          question: "Куда вы доставляете товары?",
          answer: (
            <span>
              Мы доставляем товары по всей территории Российской Федерации, а
              также в страны ЕАЭС: Казахстан, Киргизию, Армению и Беларусь.
              Актуальную информацию о странах для международной доставки можно
              получить в чате на сайте{" "}
              <a
                href="https://www.cdek.ru/"
                className="text-blue-500 hover:underline"
              >
                https://www.cdek.ru/
              </a>{" "}
              или связавшись с контакт-центром СДЭК по телефону:{" "}
              <a
                href="tel:+74950090405"
                className="text-blue-500 hover:underline"
              >
                +7 495 009 04 05
              </a>{" "}
              . Время работы с 06:00 (МСК) до 21:00 (МСК).
            </span>
          ),
        },
      ],
    },
    {
      title: "Комиссия сервиса",
      items: [
        {
          question:
            "Если моя ставка будет перебита, я должен буду заплатить комиссию?",
          answer:
            "Нет, комиссия взимается только при оплате выигранного лота. Если ваша ставка была перебита, и вы не выиграли аукцион, комиссия сервиса не будет списана.",
        },
        {
          question: "За что взимается комиссия?",
          answer: `Комиссия сервиса покрывает работу платформы и дополнительные услуги, которые мы предоставляем нашим клиентам. Это включает упаковку товаров, создание сертификатов подлинности, внедрение NFC-чипов для некоторых товаров, а также другие меры, обеспечивающие гарантию оригинальности продукции.
                Комиссия в размере 10% является стандартной практикой для крупных аукционных домов по всему миру и соответствует среднему уровню по отрасли.
              `,
        },
      ],
    },
    {
      title: "Вопросы о дополнительных услугах по оформлению",
      items: [
        {
          question: "Какие у вас есть возможности по оформлению товара?",
          answer: (
            <div>
              Мы предлагаем несколько вариантов оформления товара:
              <p className="mt-4">
                Готовые багеты — это стандартные багетные рамы, которые не
                подлежат изменению в размерах, цветах или материалах. Они будут
                доставлены вам в запечатанном виде, и вы сможете самостоятельно
                вставить товар и повесить его на стену, используя специальные
                крепления, встроенные в раму.
              </p>
              <p className="mt-4">
                Оформление в багетной мастерской — для более профессионального и
                персонализированного оформления. Мы выбрали мастерскую с
                наибольшим опытом работы с спортивными товарами, которая
                аккуратно вшивает товар тонкими нитками, не повреждая его. Вы
                можете выбрать расположение товара, цвет и материал рамы, тип
                стекла и добавить фото или надписи по вашему желанию.
              </p>
              <p className="mt-4">
                Акриловые кейсы — идеальный вариант для хранения таких
                предметов, как коньки, краги, шайбы, бутсы, мячи и т.д.
                Акриловые кейсы можно выбрать из доступных вариантов, заказав их
                заранее.
              </p>
              <p className="mt-4">
                Более подробную информацию можно получить по ссылке{" "}
                <NavLink to="/framing" className="text-blue-500">
                  https://fansdream.ru/framing
                </NavLink>
              </p>
            </div>
          ),
        },
        {
          question: "Я могу получить товар в багетной раме?",
          answer: (
            <span>
              Да, вы можете заказать оформление выигранного товара в багетную
              раму. После оплаты товара вы получите email с пошаговыми
              инструкциями по заказу оформления. Если у вас остались вопросы,
              напишите нам на почту{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              .
            </span>
          ),
        },
        {
          question:
            "Сколько времени занимает процесс оформления товара в багетную раму?",
          answer: `Оформление товара в багетную раму начинается сразу после получения оплаты. Этот процесс выполняется вручную и может занять до 10 рабочих дней. Однако чаще всего мы отдаем заказы уже в течение 2-3 рабочих дней. Как только курьер заберет оформленный товар для отправки, вы получите по электронной почте номер для отслеживания посылки.`,
        },
        {
          question:
            "Могу ли я изменить заказ на оформление в багет после того, как он был сделан?",
          answer: (
            <span>
              Да, это возможно. Однако, если оплата уже была произведена и
              производство багета началось, за каждое изменение будет взиматься
              дополнительная плата. Стоимость изменения зависит от изменений в
              заказе. Пожалуйста, свяжитесь с нами по email{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              , если вы хотите внести изменения в заказ или у вас остались
              вопросы.
            </span>
          ),
        },
        {
          question: "Какая стоимость оформления в багет?",
          answer: (
            <div>
              <p className="mt-4">
                Готовая багетная рама для самостоятельного оформления — 5 000
                руб.
              </p>
              <p className="mt-4">
                Оформление в багетной мастерской — от 15 000 руб.
              </p>
              <p className="mt-4">Стоимость акрилового кейса — от 1 000 руб.</p>
            </div>
          ),
        },
        {
          question:
            "Могу ли я отменить заказ на оформление в багет после его изготовления?",
          answer:
            "К сожалению, отменить заказ после начала оформления невозможно. Как только мы начинаем работать над оформлением, изделие создается специально для вас, с учетом ваших требований. Заказы на оформление отправляются на производство сразу после оплаты, поэтому они не могут быть отменены.",
        },
        {
          question:
            "Нужно ли мне оплачивать стоимость доставки оформленного товара?",
          answer:
            "Да, так как услуга оформления увеличивает вес и габариты товара, стоимость доставки может измениться. Перед тем как вы оплатите заказ, мы покажем, насколько изменилась стоимость доставки и сколько вам нужно доплатить за услугу оформления и доставку оформленного товара.",
        },
        {
          question: "Как оформленный товар будет доставлен?",
          answer:
            "Все оформленные товары отправляются из нашего офиса в Москве с использованием услуг СДЭК, чтобы гарантировать безопасную и быструю доставку. Для особенно хрупких товаров, таких как багетные рамы со стеклом, мы используем доставку с обрешеткой, чтобы гарантировать, что товар будет доставлен в целости и сохранности.",
        },
      ],
    },
    {
      title: "Вопросы по оплате",
      items: [
        {
          question: "Какие есть способы оплаты?",
          answer: (
            <div>
              <p className="mt-4">
                Мы предоставляем несколько способов оплаты:
              </p>
              <p className="mt-4">
                • Банковскими картами (Visa, Mastercard, МИР)
              </p>
              <p className="mt-4">• Через системы быстрых платежей (СБП)</p>
              <p className="mt-4">• Через сервисы T-Pay, SberPay и Mir Pay.</p>
            </div>
          ),
        },
        {
          question:
            "Вы спишете деньги с карты автоматически, как только я выиграю на аукционе?",
          answer:
            "Нет, деньги с карты не списываются сразу после завершения аукциона. После победы у вас будет 24 часа для самостоятельной оплаты. Если в течение этого времени оплата не будет произведена, мы спишем средства с привязанной карты.",
        },
        {
          question: "Что случится, если я не оплачу выигранный товар?",
          answer: `Ставка имеет юридическую силу, и, сделав ставку, вы соглашаетесь с условиями аукциона, обязывающими вас купить товар, если ваша ставка окажется самой высокой. Если вы не оплатите товар в течение 24 часов, мы попробуем списать денежные средства с привязанной карты. Если списание не удастся и оплата не будет произведена в течение 72 часов, ваш аккаунт будет заблокирован, и мы будем вынуждены обратиться в суд для взыскания денежных средств.`,
        },
        {
          question:
            "Почему окончательная цена выше моей ставки, есть ли дополнительные расходы?",
          answer:
            "Все дополнительные расходы будут четко указаны на странице товара до того, как вы подтвердите свою ставку. Также они будут отображены во время процесса оплаты.",
        },
        {
          question: "Могу ли я оплатить товар наличными при доставке?",
          answer:
            "Нет, оплата наличными при доставке невозможна. Все платежи происходят онлайн с использованием одного из доступных способов оплаты.",
        },
        {
          question:
            "Когда необходимо совершить оплату за выигранный на аукционе товар?",
          answer: `Оплату за товар необходимо произвести в течение 24 часов после победы на аукционе. Если оплата не поступит, мы попробуем списать денежные средства с привязанной карты. Если списание не удастся, и оплата не будет произведена в течение 72 часов, ваш аккаунт будет заблокирован, и мы будем вынуждены обратиться в суд для взыскания денежных средств.`,
        },
        {
          question: "Какие дополнительные сборы мне придется заплатить?",
          answer:
            "К окончательной цене товара добавляется 10% комиссия сервиса и стоимость доставки. Полную информацию о стоимости и дополнительных сборах можно увидеть на странице товара под кнопкой «Сделать ставку». Стоимость доставки может изменяться в зависимости от адреса доставки и габаритов товара.",
        },
        {
          question: "Где я могу найти чек за покупку?",
          answer:
            'Чек будет отправлен вам на электронную почту после оплаты. Также вы можете найти его в разделе "Мои заказы" в личном кабинете.',
        },
        {
          question: "Безопасна ли онлайн-оплата?",
          answer:
            "Да, платежи на нашем сайте защищены международным стандартом безопасности PCI DSS, который гарантирует защиту данных ваших платежных карт.",
        },
        {
          question:
            "Должен ли я платить комиссию сервиса или нести другие расходы, если моя ставка не выиграла?",
          answer:
            "Нет, комиссия сервиса и расходы на доставку взимаются только в случае победы вашей ставки на аукционе. Если ваша ставка не победила, дополнительные сборы не взымаются.",
        },
      ],
    },
    {
      title: "Товары и подлинность",
      items: [
        {
          question:
            "У меня есть коллекционные товары, как я могу передать их вам для продажи?",
          answer: (
            <span>
              Мы работаем только напрямую с клубами и профессиональными
              спортсменами, и не принимаем товары от коллекционеров. Это
              необходимо для того, чтобы мы могли гарантировать подлинность
              каждого предмета, включая подлинность автографов. Если вы
              являетесь сотрудником клуба или профессиональным спортсменом,
              напишите нам на почту{" "}
              <a
                href="mailto:business@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                business@fansdream.ru
              </a>
              , и мы свяжемся с вами для обсуждения сотрудничества.
            </span>
          ),
        },
        {
          question: "Вы можете оценить стоимость моего товара?",
          answer:
            "Мы являемся онлайн-аукционом, и не занимаемся оценкой стоимости товаров.",
        },
        {
          question: "Как вы рекомендуете хранить товар?",
          answer:
            "Мы рекомендуем хранить товар в прохладном, сухом месте с низким уровнем влажности. Избегайте воздействия прямых солнечных лучей. Также не рекомендуем стирать товар, так как это может повредить автограф и NFC-чип, если они присутствуют на товаре.",
        },
        {
          question:
            "Я видел, как спортсмен передал товар болельщику после матча, почему этот товар у вас продается?",
          answer: (
            <span>
              Мы получаем товары только напрямую от спортсменов и клубов.
              Профессиональные спортсмены часто используют несколько одинаковых
              товаров (например, футболок или джерси) во время матчей. Если вы
              видели, как спортсмен передал товар болельщику, то это может быть
              другой экземпляр, использованный в том же матче или мероприятии.
              Если у вас есть дополнительные вопросы, напишите нам на{" "}
              <a
                href="mailto:support@fansdream.ru"
                className="text-blue-500 hover:underline"
              >
                support@fansdream.ru
              </a>
              .
            </span>
          ),
        },
        {
          question: 'Что означает "worn", "с автографом" и т.д.?',
          answer: (
            <div>
              <p className="mt-4">
                Эти надписи описывают характеристики товара:
              </p>
              <p className="mt-4">
                "Worn" — означает, что товар был использован спортсменом во
                время официальных соревнований или тренировок.
              </p>
              <p className="mt-4">
                "С автографом" — означает, что на товаре есть настоящий автограф
                спортсмена.
              </p>
            </div>
          ),
        },
        {
          question: "Как мне не пропустить будущие аукционы?",
          answer: (
            <div>
              <p className="mt-4">
                Чтобы не пропустить товары от любимых спортсменов и клубов,
                подписывайтесь на наши социальные сети:
              </p>
              <ul className="space-y-2 mt-2 text-sm">
                <li>
                  <a
                    href="https://vk.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.vk")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://t.me/fansdreamru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.telegram")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.instagram.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.instagram")}
                    {"*"}
                  </a>
                </li>
              </ul>
              <p className="mt-4">
                Также вы можете перейти в раздел "Любимые команды и спортсмены"
                в личном кабинете и подписаться на интересующие вас виды спорта,
                клубы и спортсменов.
              </p>
            </div>
          ),
        },
        {
          question: "Как я могу проверить, что товар является подлинным?",
          answer: (
            <div>
              <p className="mt-4">
                Все наши товары поступают напрямую от спортсменов и клубов, что
                гарантирует их 100% подлинность. Каждый предмет сопровождается
                сертификатом подлинности с уникальным номером и QR-кодом для
                проверки.
              </p>
              <p className="mt-4">
                Для самых ценных текстильных товаров мы внедряем NFC-чипы,
                которые можно сканировать с помощью телефона для подтверждения
                оригинальности.
              </p>
              <p className="mt-4">
                Подробнее о том, как проверить подлинность товара, вы можете
                узнать по ссылке{" "}
                <NavLink to="/authenticate" className="text-blue-500">
                  https://fansdream.ru/authenticate
                </NavLink>
              </p>
              <p className="mt-4">
                Если у вас остались вопросы, напишите нам на почту{" "}
                <a
                  href="mailto:support@fansdream.ru"
                  className="text-blue-500 hover:underline"
                >
                  support@fansdream.ru
                </a>
                .
              </p>
            </div>
          ),
        },
        {
          question:
            "Меня интересует товар клуба или спортсмена, который не продается на вашей платформе.",
          answer: (
            <div>
              <p className="mt-4">
                Количество наших партнеры постоянно увеличивается. Чтобы не
                пропустить товары от любимых спортсменов и клубов,
                подписывайтесь на наши социальные сети и следите за новостями:
              </p>
              <ul className="space-y-2 mt-2 text-sm">
                <li>
                  <a
                    href="https://vk.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.vk")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://t.me/fansdreamru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.telegram")}
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.instagram.com/fansdream_ru"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    {t("footer.social.instagram")}
                    {"*"}
                  </a>
                </li>
              </ul>
              <p className="mt-4">
                Вы также можете перейти в раздел "Любимые команды и спортсмены"
                в личном кабинете и подписаться на интересующие вас виды спорта,
                клубы и спортсменов.
              </p>
            </div>
          ),
        },
        {
          question:
            "Как я узнаю, использовал ли спортсмен товар в соревнованиях?",
          answer:
            'Мы указываем всю доступную информацию о товаре в карточке товара. Если товар использовался спортсменом во время соревнований или тренировок, на нем будет указано, что он был "worn".',
        },
      ],
    },
  ];

  const filteredFaqSections = faqSections
    .map((section) => ({
      ...section,
      items: section.items.filter((item) => {
        if (!search || search.trim() === "") return true;

        const searchLower = search.toLowerCase();
        const questionLower = item.question.toLowerCase();

        if (questionLower.includes(searchLower)) return true;

        if (typeof item.answer === "string") {
          return item.answer.toLowerCase().includes(searchLower);
        }

        if (typeof item.answer === "object" && item.answer !== null) {
          const extractText = (element: any): string => {
            if (typeof element === "string") return element;
            if (typeof element === "number") return element.toString();
            if (Array.isArray(element))
              return element.map(extractText).join(" ");
            if (element && typeof element === "object" && element.props) {
              return extractText(element.props.children);
            }
            return "";
          };

          const answerText = extractText(item.answer);
          return answerText.toLowerCase().includes(searchLower);
        }

        return false;
      }),
    }))
    .filter((section) => section.items.length > 0);

  const onSubmit = (data: FeedbackFormData) => {
    if (sendSupportMutation.isPending) return;

    setSubmitMessage(null);

    sendSupportMutation.mutate(
      {
        category: "faq",
        subject: "Вопрос с страницы FAQ",
        message: `${data.message}\n\nТелефон: ${data.phone}`,
        email: data.email,
        name: data.name,
      },
      {
        onSuccess: () => {
          setSubmitMessage(
            "Ваше обращение успешно отправлено. Мы свяжемся с вами в ближайшее время."
          );
          // Очищаем форму, сохраняя данные пользователя
          reset({
            name: user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() : "",
            email: user?.email || "",
            phone: user?.phone || "",
            message: "",
            search: "",
          });
          // Автоматически скрываем сообщение через 5 секунд
          setTimeout(() => {
            setSubmitMessage(null);
          }, 5000);
        },
        onError: (error) => {
          console.error("Ошибка при отправке обращения:", error);
          setSubmitMessage(
            "Произошла ошибка при отправке обращения. Попробуйте еще раз."
          );
        },
      }
    );
  };

  console.log(embedded);
  return (
    <div
      className={`min-h-screen px-0 sm:px-4 ${
        !embedded ? "mt-10 sm:mt-20 lg:mt-30 pt-16 bg-gray-50" : ""
      }`}
    >
      <div className={cn("w-full", !embedded ? "bg-[#F8F8F8]" : "")}>
        <div className="container">
          <div className="w-full mb-8 mt-4">
            <div className="relative w-full md:w-[70%]">
              <span className="absolute left-5 top-1/2 -translate-y-1/2 text-black">
                <svg width="28" height="28" fill="none" viewBox="0 0 24 24">
                  <circle
                    cx="11"
                    cy="11"
                    r="8"
                    stroke="#121212"
                    strokeWidth="2"
                  />
                  <path
                    d="M21 21l-4.35-4.35"
                    stroke="#121212"
                    strokeWidth="2"
                    strokeLinecap="round"
                  />
                </svg>
              </span>
              <input
                type="text"
                className={cn(
                  "w-full pl-14 pr-4 py-4 rounded-xl text-base sm:text-lg font-normal outline-none placeholder:text-gray-400 bg-white",
                  embedded ? "border-gray-200 border" : "border-none"
                )}
                placeholder="ПОИСК НУЖНОГО ВОПРОСА..."
                {...register("search")}
              />
            </div>
          </div>
          <h1 className="text-xl sm:text-2xl md:text-3xl text-[#121212] text-left uppercase">
            Частые вопросы
          </h1>

          <div className="mt-4">
            {filteredFaqSections.map((section, sIdx) => (
              <div key={section.title + sIdx} className="mb-4">
                <div className="font-medium text-base sm:text-lg mb-2 mt-6 uppercase">
                  {section.title}
                </div>
                <div className="divide-y divide-gray-200 overflow-hidden">
                  {section.items.map((item, qIdx) => {
                    const isOpen =
                      open && open.section === sIdx && open.item === qIdx;
                    return (
                      <div key={item.question}>
                        <button
                          className="w-full flex justify-between items-center pt-4 text-left hover:bg-gray-50 transition-colors focus:outline-none"
                          onClick={() =>
                            setOpen(
                              isOpen ? null : { section: sIdx, item: qIdx }
                            )
                          }
                        >
                          <span className="text-base sm:text-lg text-[#121212] pl-4">
                            {item.question}
                          </span>
                          <svg
                            className={`w-5 h-5 ml-2 transition-transform duration-200 ${
                              isOpen ? "rotate-180" : ""
                            }`}
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              strokeLinecap="round"
                              strokeLinejoin="round"
                              strokeWidth={2}
                              d="M19 9l-7 7-7-7"
                            />
                          </svg>
                        </button>
                        <div
                          className={`pb-4 text-gray-700 text-sm sm:text-base transition-all duration-200 overflow-hidden pl-4  ${
                            isOpen
                              ? "max-h-[5000px] opacity-100 "
                              : "max-h-0 opacity-0"
                          }`}
                          style={{ pointerEvents: isOpen ? "auto" : "none" }}
                        >
                          {isOpen && item.answer}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}

            {filteredFaqSections.length === 0 &&
              search &&
              search.trim() !== "" && (
                <div className="text-center py-8">
                  <p className="text-gray-500 text-lg">
                    По вашему запросу "{search}" ничего не найдено
                  </p>
                  <p className="text-gray-400 mt-2">
                    Попробуйте изменить поисковый запрос
                  </p>
                </div>
              )}
          </div>
        </div>
      </div>
      <div className="w-full bg-[#FFF]">
        <div className="container py-16 px-4 sm:px-6 lg:px-8">
          <div
            className={`grid grid-cols-1 ${
              embedded ? "" : "md:grid-cols-2"
            } gap-8 items-top`}
          >
            <div>
              <h2 className="text-2xl sm:text-3xl text-[#121212] uppercase mb-2">
                НЕ НАШЛИ ОТВЕТ?
                <br />
                НАПИШИТЕ НАМ
              </h2>
              <p className="text-sm sm:text-base text-gray-600 mb-4">
                Заполните короткую форму и мы свяжемся с вами
              </p>
              <div className="flex flex-col space-y-4">
                <div className="flex items-center">
                  <div className="w-12 h-12 bg-black rounded-full flex items-center justify-center">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="white"
                      strokeWidth="2"
                    >
                      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                      <polyline points="22,6 12,13 2,6" />
                    </svg>
                  </div>
                  <a
                    href="mailto:support@fansdream.ru"
                    className="ml-4 text-lg"
                  >
                    support@fansdream.ru
                  </a>
                </div>
              </div>
            </div>
            <div>
              <form onSubmit={handleSubmit(onSubmit)}>
                <div className="flex flex-col gap-2 p-5 bg-[#F8F8F8] rounded-xl">
                  <Input
                    {...register("name")}
                    placeholder={t("pages.partners.form.name_placeholder")}
                    error={errors.name?.message}
                  />

                  <Input
                    {...register("email")}
                    placeholder={t("pages.partners.form.email_placeholder")}
                    error={errors.email?.message}
                  />

                  <Controller
                    name="phone"
                    control={control}
                    render={({ field, fieldState }) => (
                      <Input
                        {...field}
                        value={field.value}
                        onChange={(e) => {
                          const formatted = formatPhoneNumber(e.target.value);
                          field.onChange(formatted);
                        }}
                        placeholder={t(
                          "verification_dialog.step_2.phone_placeholder"
                        )}
                        type="tel"
                        error={fieldState.error?.message}
                      />
                    )}
                  />

                  <textarea
                    {...register("message")}
                    className={cn(
                      "bg-white rounded-lg py-[10px] px-[30px] text-[#121212] text-base resize-none border ",
                      errors.message ? "border-red-500" : "border-[#CFCFCF]"
                    )}
                    style={{ height: "124px" }}
                    placeholder={t("pages.partners.form.message_placeholder")}
                  ></textarea>
                  {errors.message && (
                    <p className="text-red-500 text-sm mt-2">
                      {errors.message.message}
                    </p>
                  )}
                </div>

                {submitMessage && (
                  <div
                    className={cn(
                      "p-4 rounded-lg mt-4 text-sm",
                      submitMessage.includes("успешно")
                        ? "bg-green-50 text-green-700 border border-green-200"
                        : "bg-red-50 text-red-700 border border-red-200"
                    )}
                  >
                    {submitMessage}
                  </div>
                )}

                <AppButton
                  className="w-full flex items-center justify-center gap-2 mt-5"
                  disabled={sendSupportMutation.isPending || !isValid}
                >
                  {sendSupportMutation.isPending
                    ? "Отправка..."
                    : "отправить запрос"}
                  {!sendSupportMutation.isPending && <RiArrowRightLongLine />}
                </AppButton>
              </form>
            </div>
          </div>
        </div>
      </div>
      <LoginModal
        isOpen={isLoginModalOpen}
        onClose={() => setIsLoginModalOpen(false)}
      />
    </div>
  );
}

export default function FAQ() {
  return <FAQComponent embedded={false} />;
}
